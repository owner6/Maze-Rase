<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ó–æ–º–±—ñ-–ê–ø–æ–∫–∞–ª—ñ–ø—Å–∏—Å: –õ–∞–±—ñ—Ä–∏–Ω—Ç –í–∏–∂–∏–≤–∞–Ω–Ω—è</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
      color: #e74c3c;
    }

    .controls {
      display: flex;
      gap: 15px;
      margin-bottom: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .btn {
      padding: 12px 24px;
      background: linear-gradient(45deg, #e74c3c, #c0392b);
      border: none;
      border-radius: 25px;
      color: white;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }

    .btn:disabled {
      background: #666;
      cursor: not-allowed;
      transform: none;
    }

    .game-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: rgba(255,255,255,0.05);
      border-radius: 20px;
      padding: 20px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      max-width: 800px;
      width: 100%;
    }

    .player-info {
      margin-bottom: 15px;
      text-align: center;
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .player-name {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 5px;
      color: #3498db;
    }

    .player-status {
      font-size: 1.1em;
      padding: 5px 15px;
      border-radius: 15px;
      display: inline-block;
    }

    .status-ready { background: rgba(52, 152, 219, 0.8); }
    .status-playing { background: rgba(46, 204, 113, 0.8); }
    .status-finished { background: rgba(231, 76, 60, 0.8); }
    .status-winner { background: rgba(241, 196, 15, 0.8); }

    .maze-container {
      border: 3px solid rgba(255,255,255,0.2);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      margin-bottom: 20px;
    }

    .maze {
      display: grid;
      background: #2c3e50;
    }

    .cell {
      width: 12px;
      height: 12px;
      border: 0.5px solid rgba(52, 73, 94, 0.5);
    }

    .wall { background: #34495e; }
    .path { background: #ecf0f1; }
    .start { background: #27ae60; }
    .end { background: #e74c3c; }
    .player { background: #3498db; box-shadow: 0 0 10px #3498db; }
    .zombie { 
      background: #8B4513; 
      box-shadow: 0 0 8px #8B4513;
      border-radius: 50%;
    }
    .zombie-fast { 
      background: #FF4500; 
      box-shadow: 0 0 8px #FF4500;
      border-radius: 50%;
    }
    .zombie-boss { 
      background: #800000; 
      box-shadow: 0 0 12px #800000;
      border-radius: 30%;
    }
    .ammo-cell {
      background: #FFD700;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #FFA500;
      z-index: 2;
    }
    .health-cell {
      background: #FF69B4;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #FF1493;
      z-index: 2;
    }
    .shield-cell {
      background: #00CED1;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #008B8B;
      z-index: 2;
    }
    .safe-zone {
      background: #32CD32;
      border: 2px solid #228B22;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { opacity: 0.7; }
      50% { opacity: 1; }
      100% { opacity: 0.7; }
    }

    .timer {
      font-size: 1.2em;
      margin: 15px 0;
      padding: 10px 20px;
      background: rgba(0,0,0,0.5);
      border-radius: 15px;
    }

    .stats-bar {
      display: flex;
      gap: 20px;
      margin: 10px 0;
      flex-wrap: wrap;
      justify-content: center;
    }

    .stat-item {
      background: rgba(0,0,0,0.3);
      padding: 8px 15px;
      border-radius: 10px;
      font-size: 14px;
    }

    .instructions {
      margin-top: 20px;
      text-align: center;
      max-width: 600px;
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 15px;
      backdrop-filter: blur(10px);
    }

    .winner-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .winner-modal {
      background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
      padding: 40px;
      border-radius: 20px;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.7);
      animation: modalAppear 0.5s ease-out;
    }

    @keyframes modalAppear {
      from { transform: scale(0.5); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .winner-text {
      font-size: 3em;
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    }

    .size-controls {
      display: flex;
      gap: 10px;
      align-items: center;
      margin: 10px 0;
    }

    .size-controls label {
      font-weight: bold;
    }

    .size-controls select {
      padding: 8px;
      border-radius: 8px;
      border: none;
      background: rgba(255,255,255,0.2);
      color: white;
      font-size: 14px;
    }

    .event-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(45deg, #e74c3c, #c0392b);
      color: white;
      padding: 15px 20px;
      border-radius: 10px;
      font-weight: bold;
      font-size: 16px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
      z-index: 1000;
      animation: slideInRight 0.5s ease-out;
      max-width: 300px;
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }

    @media (max-width: 768px) {
      .cell {
        width: 10px;
        height: 10px;
      }

      .header h1 {
        font-size: 2em;
      }
    }
  </style>
</head>
<body>
<div class="header">
  <h1>üßü‚Äç‚ôÇÔ∏è –ó–æ–º–±—ñ-–ê–ø–æ–∫–∞–ª—ñ–ø—Å–∏—Å: –õ–∞–±—ñ—Ä–∏–Ω—Ç –í–∏–∂–∏–≤–∞–Ω–Ω—è</h1>
</div>

<div class="controls">
  <div class="size-controls">
    <label>–†—ñ–≤–µ–Ω—å —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ:</label>
    <select id="difficultyLevel">
      <option value="easy" selected>–õ–µ–≥–∫–∏–π</option>
      <option value="medium">–°–µ—Ä–µ–¥–Ω—ñ–π</option>
      <option value="hard">–í–∞–∂–∫–∏–π</option>
      <option value="nightmare">–ö–æ—à–º–∞—Ä</option>
    </select>
  </div>
  <button class="btn" id="newGameBtn">üßü‚Äç‚ôÇÔ∏è –ù–æ–≤–∞ –≥—Ä–∞</button>
  <button class="btn" id="pauseBtn" disabled>‚è∏Ô∏è –ü–∞—É–∑–∞</button>
  <button class="btn" id="helpBtn">‚ùì –î–æ–ø–æ–º–æ–≥–∞</button>
</div>

<div class="timer" id="timer">–ß–∞—Å –≤–∏–∂–∏–≤–∞–Ω–Ω—è: 00:00</div>

<div class="game-container">
  <div class="player-info">
    <div>
      <div class="player-name">üéØ –ì–†–ê–í–ï–¶–¨</div>
      <div class="player-status status-ready" id="playerStatus">–ì–æ—Ç–æ–≤ –¥–æ –≤–∏–∂–∏–≤–∞–Ω–Ω—è</div>
    </div>
  </div>
  
  <div class="stats-bar" id="statsBar">
    <div class="stat-item">‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤'—è: <span id="healthDisplay">100</span></div>
    <div class="stat-item">üõ°Ô∏è –©–∏—Ç: <span id="shieldDisplay">0</span></div>
    <div class="stat-item">üî´ –ü–∞—Ç—Ä–æ–Ω–∏: <span id="ammoDisplay">10</span></div>
    <div class="stat-item">üßü‚Äç‚ôÇÔ∏è –ó–æ–º–±—ñ: <span id="zombieCount">0</span></div>
    <div class="stat-item">üèÜ –†—ñ–≤–µ–Ω—å: <span id="levelDisplay">1</span></div>
  </div>

  <div class="maze-container">
    <div class="maze" id="maze"></div>
  </div>
</div>

<div class="winner-overlay" id="winnerOverlay">
  <div class="winner-modal">
    <div class="winner-text" id="winnerText">üèÜ –í–ò–ñ–ò–í!</div>
    <p id="winnerMessage">–í—ñ—Ç–∞—î–º–æ –∑ –≤–∏–∂–∏–≤–∞–Ω–Ω—è–º!</p>
    <button class="btn" id="playAgainBtn">üîÑ –ì—Ä–∞—Ç–∏ –∑–Ω–æ–≤—É</button>
  </div>
</div>

<script>
class MazeGenerator {
  constructor(size) {
    this.size = size;
    this.maze = [];
    this.generate();
  }

  generate() {
    this.maze = Array(this.size).fill().map(() => Array(this.size).fill(1));
    const stack = [];
    const start = [1, 1];
    this.maze[start[0]][start[1]] = 0;
    stack.push(start);

    while (stack.length > 0) {
      const current = stack[stack.length - 1];
      const neighbors = this.getUnvisitedNeighbors(current);

      if (neighbors.length > 0) {
        const next = neighbors[Math.floor(Math.random() * neighbors.length)];
        this.removeWall(current, next);
        this.maze[next[0]][next[1]] = 0;
        stack.push(next);
      } else {
        stack.pop();
      }
    }

    this.maze[this.size - 2][this.size - 2] = 0;
  }

  getUnvisitedNeighbors([row, col]) {
    const neighbors = [];
    const directions = [[0, 2], [2, 0], [0, -2], [-2, 0]];

    for (const [dr, dc] of directions) {
      const newRow = row + dr;
      const newCol = col + dc;

      if (newRow > 0 && newRow < this.size - 1 &&
        newCol > 0 && newCol < this.size - 1 &&
        this.maze[newRow][newCol] === 1) {
        neighbors.push([newRow, newCol]);
      }
    }

    return neighbors;
  }

  removeWall([row1, col1], [row2, col2]) {
    const wallRow = (row1 + row2) / 2;
    const wallCol = (col1 + col2) / 2;
    this.maze[wallRow][wallCol] = 0;
  }
}

class ZombieApocalypseGame {
  constructor() {
    this.size = 31;
    this.maze = null;
    this.playerPos = [1, 1];
    this.isGameActive = false;
    this.isPaused = false;
    this.startTime = null;
    this.timerInterval = null;
    this.playerDirection = null;
    this.playerMoveInterval = null;
    this.zombies = [];
    this.zombieMoveInterval = null;
    this.eventInterval = null;
    this.itemSpawnInterval = null;
    
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä–∞–≤—Ü—è
    this.playerHealth = 100;
    this.playerShield = 0;
    this.playerAmmo = 10;
    this.playerLevel = 1;
    this.zombiesKilled = 0;
    this.survivalTime = 0;
    
    // –ü—Ä–µ–¥–º–µ—Ç–∏
    this.ammoPos = null;
    this.ammoVisible = false;
    this.ammoTimeout = null;
    this.healthPos = null;
    this.healthVisible = false;
    this.healthTimeout = null;
    this.shieldPos = null;
    this.shieldVisible = false;
    this.shieldTimeout = null;
    
    // –ë–µ–∑–ø–µ—á–Ω—ñ –∑–æ–Ω–∏
    this.safeZones = [];
    this.safeZoneTimeout = null;
    
    // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ
    this.difficulty = 'easy';
    this.zombieSpawnRate = 5000;
    this.itemSpawnRate = 8000;
    this.safeZoneRate = 15000;
    
    this.initializeElements();
    this.setupEventListeners();
  }

  initializeElements() {
    this.mazeEl = document.getElementById('maze');
    this.playerStatusEl = document.getElementById('playerStatus');
    this.timerEl = document.getElementById('timer');
    this.winnerOverlay = document.getElementById('winnerOverlay');
    this.winnerText = document.getElementById('winnerText');
    this.winnerMessage = document.getElementById('winnerMessage');
    this.newGameBtn = document.getElementById('newGameBtn');
    this.pauseBtn = document.getElementById('pauseBtn');
    this.playAgainBtn = document.getElementById('playAgainBtn');
    this.difficultySelect = document.getElementById('difficultyLevel');
  }

  setupEventListeners() {
    this.newGameBtn.addEventListener('click', () => this.newGame());
    this.pauseBtn.addEventListener('click', () => this.togglePause());
    this.playAgainBtn.addEventListener('click', () => this.newGame());

    document.getElementById('helpBtn').addEventListener('click', () => {
      alert('üßü‚Äç‚ôÇÔ∏è –ó–û–ú–ë–Ü-–ê–ü–û–ö–ê–õ–Ü–ü–°–ò–°: –õ–ê–ë–Ü–†–ò–ù–¢ –í–ò–ñ–ò–í–ê–ù–ù–Ø\n\nüéØ –¶—ñ–ª—å: –í–∏–∂–∏—Ç–∏ —è–∫–æ–º–æ–≥–∞ –¥–æ–≤—à–µ, –∑–±–∏—Ä–∞—é—á–∏ —Ä–µ—Å—É—Ä—Å–∏ —Ç–∞ —É–Ω–∏–∫–∞—é—á–∏ –∑–æ–º–±—ñ!\n\nüéÆ –ö–µ—Ä—É–≤–∞–Ω–Ω—è:\n‚Ä¢ –°—Ç—Ä—ñ–ª–∫–∏ ‚Üê‚Üë‚Üì‚Üí –∞–±–æ WASD –¥–ª—è —Ä—É—Ö—É\n‚Ä¢ –ü—Ä–æ–±—ñ–ª –¥–ª—è —Å—Ç—Ä—ñ–ª—å–±–∏ (—è–∫—â–æ —î –ø–∞—Ç—Ä–æ–Ω–∏)\n\nüìã –ü—Ä–∞–≤–∏–ª–∞:\n‚Ä¢ –ó–µ–ª–µ–Ω–∏–π –∫–≤–∞–¥—Ä–∞—Ç - —Å—Ç–∞—Ä—Ç\n‚Ä¢ –ó–æ–º–±—ñ —Ä—É—Ö–∞—é—Ç—å—Å—è –¥–æ –≤–∞—Å\n‚Ä¢ –ó–±–∏—Ä–∞–π—Ç–µ –ø–∞—Ç—Ä–æ–Ω–∏, –∑–¥–æ—Ä–æ–≤\'—è —Ç–∞ —â–∏—Ç–∏\n‚Ä¢ –ë–µ–∑–ø–µ—á–Ω—ñ –∑–æ–Ω–∏ —Ç–∏–º—á–∞—Å–æ–≤–æ –∑–∞—Ö–∏—â–∞—é—Ç—å –≤—ñ–¥ –∑–æ–º–±—ñ\n‚Ä¢ –ö–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥ —Ä—ñ–≤–µ–Ω—å —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ –∑—Ä–æ—Å—Ç–∞—î!');
    });

    document.addEventListener('keydown', (e) => this.handleKeyPress(e));
    this.difficultySelect.addEventListener('change', (e) => {
      this.difficulty = e.target.value;
      this.updateDifficultySettings();
    });
  }

  updateDifficultySettings() {
    switch(this.difficulty) {
      case 'easy':
        this.zombieSpawnRate = 5000;
        this.itemSpawnRate = 8000;
        this.safeZoneRate = 15000;
        break;
      case 'medium':
        this.zombieSpawnRate = 4000;
        this.itemSpawnRate = 7000;
        this.safeZoneRate = 12000;
        break;
      case 'hard':
        this.zombieSpawnRate = 3000;
        this.itemSpawnRate = 6000;
        this.safeZoneRate = 10000;
        break;
      case 'nightmare':
        this.zombieSpawnRate = 2000;
        this.itemSpawnRate = 5000;
        this.safeZoneRate = 8000;
        break;
    }
  }

  clearAllIntervals() {
    if (this.timerInterval) clearInterval(this.timerInterval);
    if (this.playerMoveInterval) clearInterval(this.playerMoveInterval);
    if (this.zombieMoveInterval) clearInterval(this.zombieMoveInterval);
    if (this.eventInterval) clearInterval(this.eventInterval);
    if (this.itemSpawnInterval) clearInterval(this.itemSpawnInterval);
    if (this.ammoTimeout) clearTimeout(this.ammoTimeout);
    if (this.healthTimeout) clearTimeout(this.healthTimeout);
    if (this.shieldTimeout) clearTimeout(this.shieldTimeout);
    if (this.safeZoneTimeout) clearTimeout(this.safeZoneTimeout);
  }

  newGame() {
    this.clearAllIntervals();
    this.isGameActive = true;
    this.isPaused = false;
    this.startTime = Date.now();
    this.playerPos = [1, 1];
    this.playerDirection = null;
    
    // –°–∫–∏–¥–∞–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    this.playerHealth = 100;
    this.playerShield = 0;
    this.playerAmmo = 10;
    this.playerLevel = 1;
    this.zombiesKilled = 0;
    this.survivalTime = 0;
    
    // –°–∫–∏–¥–∞–Ω–Ω—è –ø—Ä–µ–¥–º–µ—Ç—ñ–≤
    this.ammoPos = null;
    this.ammoVisible = false;
    this.healthPos = null;
    this.healthVisible = false;
    this.shieldPos = null;
    this.shieldVisible = false;
    this.safeZones = [];
    
    // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –ª–∞–±—ñ—Ä–∏–Ω—Ç—É
    const generator = new MazeGenerator(this.size);
    this.maze = generator.maze.map(row => [...row]);
    
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∑–æ–º–±—ñ
    this.zombies = [];
    this.spawnInitialZombies();
    
    this.renderMaze();
    this.updateStatus('playing');
    this.updateStats();
    this.startTimer();
    this.startPlayerAutoMove();
    this.startZombieAI();
    this.startItemSpawning();
    this.startSafeZoneSpawning();
    
    this.newGameBtn.textContent = 'üîÑ –ù–æ–≤–∞ –≥—Ä–∞';
    this.pauseBtn.disabled = false;
    this.winnerOverlay.style.display = 'none';
  }

  spawnInitialZombies() {
    const initialZombieCount = this.difficulty === 'easy' ? 3 : 
                              this.difficulty === 'medium' ? 5 :
                              this.difficulty === 'hard' ? 8 : 12;
    
    for (let i = 0; i < initialZombieCount; i++) {
      this.spawnZombie();
    }
  }

  spawnZombie() {
    const pos = this.getRandomEmptyPosition();
    const zombieType = Math.random() < 0.1 ? 'boss' : 
                      Math.random() < 0.3 ? 'fast' : 'normal';
    
    this.zombies.push({
      pos: pos,
      type: zombieType,
      health: zombieType === 'boss' ? 3 : 1,
      speed: zombieType === 'fast' ? 80 : zombieType === 'boss' ? 120 : 100
    });
  }

  getRandomEmptyPosition() {
    let row, col;
    do {
      row = Math.floor(Math.random() * (this.size - 2)) + 1;
      col = Math.floor(Math.random() * (this.size - 2)) + 1;
    } while (
      this.maze[row][col] === 1 ||
      (row === this.playerPos[0] && col === this.playerPos[1]) ||
      this.zombies.some(z => z.pos[0] === row && z.pos[1] === col) ||
      this.safeZones.some(sz => sz[0] === row && sz[1] === col)
    );
    return [row, col];
  }

  renderMaze() {
    this.mazeEl.innerHTML = '';
    this.mazeEl.style.gridTemplateColumns = `repeat(${this.size}, 1fr)`;
    
    for (let row = 0; row < this.size; row++) {
      for (let col = 0; col < this.size; col++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        
        if (this.maze[row][col] === 1) {
          cell.classList.add('wall');
        } else {
          cell.classList.add('path');
        }
        
        // –°—Ç–∞—Ä—Ç
        if (row === 1 && col === 1) {
          cell.classList.add('start');
        }
        
        // –§—ñ–Ω—ñ—à
        if (row === this.size - 2 && col === this.size - 2) {
          cell.classList.add('end');
        }
        
        // –ì—Ä–∞–≤–µ—Ü—å
        if (row === this.playerPos[0] && col === this.playerPos[1]) {
          cell.classList.add('player');
        }
        
        // –ó–æ–º–±—ñ
        for (const zombie of this.zombies) {
          if (row === zombie.pos[0] && col === zombie.pos[1]) {
            cell.classList.add('zombie');
            if (zombie.type === 'fast') cell.classList.add('zombie-fast');
            if (zombie.type === 'boss') cell.classList.add('zombie-boss');
          }
        }
        
        // –ü—Ä–µ–¥–º–µ—Ç–∏
        if (this.ammoVisible && this.ammoPos && row === this.ammoPos[0] && col === this.ammoPos[1]) {
          cell.classList.add('ammo-cell');
          cell.innerHTML = '<span style="font-size:12px;">üî´</span>';
        }
        
        if (this.healthVisible && this.healthPos && row === this.healthPos[0] && col === this.healthPos[1]) {
          cell.classList.add('health-cell');
          cell.innerHTML = '<span style="font-size:12px;">‚ù§Ô∏è</span>';
        }
        
        if (this.shieldVisible && this.shieldPos && row === this.shieldPos[0] && col === this.shieldPos[1]) {
          cell.classList.add('shield-cell');
          cell.innerHTML = '<span style="font-size:12px;">üõ°Ô∏è</span>';
        }
        
        // –ë–µ–∑–ø–µ—á–Ω—ñ –∑–æ–Ω–∏
        if (this.safeZones.some(sz => sz[0] === row && sz[1] === col)) {
          cell.classList.add('safe-zone');
        }
        
        this.mazeEl.appendChild(cell);
      }
    }
  }

  handleKeyPress(e) {
    if (!this.isGameActive || this.isPaused) return;

    const keyMap = {
      'ArrowUp': [-1, 0], 'KeyW': [-1, 0],
      'ArrowDown': [1, 0], 'KeyS': [1, 0],
      'ArrowLeft': [0, -1], 'KeyA': [0, -1],
      'ArrowRight': [0, 1], 'KeyD': [0, 1]
    };

    const direction = keyMap[e.code];
    if (direction) {
      e.preventDefault();
      this.playerDirection = direction;
    }

    // –°—Ç—Ä—ñ–ª—å–±–∞
    if (e.code === 'Space' && this.playerAmmo > 0) {
      e.preventDefault();
      this.shoot();
    }
  }

  shoot() {
    if (this.playerAmmo <= 0) return;
    
    this.playerAmmo--;
    this.updateStats();
    
    // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –Ω–∞–π–±–ª–∏–∂—á–æ–≥–æ –∑–æ–º–±—ñ –≤ –ø—Ä—è–º—ñ–π –≤–∏–¥–∏–º–æ—Å—Ç—ñ
    const directions = [[-1,0],[1,0],[0,-1],[0,1]];
    for (const [dr, dc] of directions) {
      let r = this.playerPos[0] + dr;
      let c = this.playerPos[1] + dc;
      
      while (r >= 0 && r < this.size && c >= 0 && c < this.size && this.maze[r][c] === 0) {
        const zombieIndex = this.zombies.findIndex(z => z.pos[0] === r && z.pos[1] === c);
        if (zombieIndex !== -1) {
          const zombie = this.zombies[zombieIndex];
          zombie.health--;
          
          if (zombie.health <= 0) {
            this.zombies.splice(zombieIndex, 1);
            this.zombiesKilled++;
            this.showEventNotification('üßü‚Äç‚ôÇÔ∏è –ó–æ–º–±—ñ –∑–Ω–∏—â–µ–Ω–æ!');
          } else {
            this.showEventNotification('üí• –ó–æ–º–±—ñ –ø–æ—Ä–∞–Ω–µ–Ω–æ!');
          }
          break;
        }
        r += dr;
        c += dc;
      }
    }
    
    this.renderMaze();
  }

  startPlayerAutoMove() {
    if (this.playerMoveInterval) clearInterval(this.playerMoveInterval);
    this.playerMoveInterval = setInterval(() => {
      if (!this.isGameActive || this.isPaused || !this.playerDirection) return;
      
      const newRow = this.playerPos[0] + this.playerDirection[0];
      const newCol = this.playerPos[1] + this.playerDirection[1];
      
      if (this.isValidMove(newRow, newCol)) {
        this.playerPos = [newRow, newCol];
        this.checkItemPickup();
        this.checkSafeZone();
        this.renderMaze();
        this.checkCollision();
      }
    }, 100);
  }

  isValidMove(row, col) {
    return row >= 0 && row < this.size && col >= 0 && col < this.size && this.maze[row][col] === 0;
  }

  checkItemPickup() {
    // –ü–∞—Ç—Ä–æ–Ω–∏
    if (this.ammoVisible && this.ammoPos && 
        this.playerPos[0] === this.ammoPos[0] && this.playerPos[1] === this.ammoPos[1]) {
      this.playerAmmo += 5;
      this.hideAmmo();
      this.showEventNotification('üî´ +5 –ø–∞—Ç—Ä–æ–Ω—ñ–≤!');
    }
    
    // –ó–¥–æ—Ä–æ–≤'—è
    if (this.healthVisible && this.healthPos && 
        this.playerPos[0] === this.healthPos[0] && this.playerPos[1] === this.healthPos[1]) {
      this.playerHealth = Math.min(100, this.playerHealth + 30);
      this.hideHealth();
      this.showEventNotification('‚ù§Ô∏è +30 –∑–¥–æ—Ä–æ–≤\'—è!');
    }
    
    // –©–∏—Ç
    if (this.shieldVisible && this.shieldPos && 
        this.playerPos[0] === this.shieldPos[0] && this.playerPos[1] === this.shieldPos[1]) {
      this.playerShield = Math.min(100, this.playerShield + 50);
      this.hideShield();
      this.showEventNotification('üõ°Ô∏è +50 —â–∏—Ç–∞!');
    }
    
    this.updateStats();
  }

  checkSafeZone() {
    const inSafeZone = this.safeZones.some(sz => 
      sz[0] === this.playerPos[0] && sz[1] === this.playerPos[1]
    );
    
    if (inSafeZone) {
      this.playerStatusEl.textContent = 'üõ°Ô∏è –í –±–µ–∑–ø–µ—á–Ω—ñ–π –∑–æ–Ω—ñ';
      this.playerStatusEl.style.background = 'rgba(46, 204, 113, 0.8)';
    } else {
      this.playerStatusEl.textContent = 'üßü‚Äç‚ôÇÔ∏è –í–∏–∂–∏–≤–∞—î...';
      this.playerStatusEl.style.background = 'rgba(52, 152, 219, 0.8)';
    }
  }

  startZombieAI() {
    if (this.zombieMoveInterval) clearInterval(this.zombieMoveInterval);
    
    setTimeout(() => {
      if (!this.isGameActive) return;
      
      this.zombieMoveInterval = setInterval(() => {
        if (!this.isGameActive || this.isPaused) return;
        this.moveZombies();
      }, 150);
    }, 2000);
  }

  moveZombies() {
    for (const zombie of this.zombies) {
      // –ü—Ä–æ—Å—Ç–∏–π AI: —Ä—É—Ö–∞—î–º–æ—Å—è –¥–æ –≥—Ä–∞–≤—Ü—è
      const [zRow, zCol] = zombie.pos;
      const [pRow, pCol] = this.playerPos;
      
      const directions = [[-1,0],[1,0],[0,-1],[0,1]];
      let bestDirection = null;
      let bestDistance = Infinity;
      
      for (const [dr, dc] of directions) {
        const newRow = zRow + dr;
        const newCol = zCol + dc;
        
        if (this.isValidMove(newRow, newCol)) {
          const distance = Math.abs(newRow - pRow) + Math.abs(newCol - pCol);
          if (distance < bestDistance) {
            bestDistance = distance;
            bestDirection = [dr, dc];
          }
        }
      }
      
      if (bestDirection) {
        zombie.pos = [zRow + bestDirection[0], zCol + bestDirection[1]];
      }
    }
    
    this.renderMaze();
    this.checkCollision();
  }

  checkCollision() {
    for (const zombie of this.zombies) {
      if (zombie.pos[0] === this.playerPos[0] && zombie.pos[1] === this.playerPos[1]) {
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –≥—Ä–∞–≤–µ—Ü—å –≤ –±–µ–∑–ø–µ—á–Ω—ñ–π –∑–æ–Ω—ñ
        const inSafeZone = this.safeZones.some(sz => 
          sz[0] === this.playerPos[0] && sz[1] === this.playerPos[1]
        );
        
        if (!inSafeZone) {
          const damage = zombie.type === 'boss' ? 30 : zombie.type === 'fast' ? 20 : 15;
          
          if (this.playerShield > 0) {
            const shieldDamage = Math.min(this.playerShield, damage);
            this.playerShield -= shieldDamage;
            const remainingDamage = damage - shieldDamage;
            this.playerHealth -= remainingDamage;
          } else {
            this.playerHealth -= damage;
          }
          
          this.updateStats();
          this.showEventNotification(`üí• –û—Ç—Ä–∏–º–∞–Ω–æ ${damage} –ø–æ—à–∫–æ–¥–∂–µ–Ω—å!`);
          
          if (this.playerHealth <= 0) {
            this.endGame(false);
            return;
          }
        }
      }
    }
  }

  startItemSpawning() {
    this.itemSpawnInterval = setInterval(() => {
      if (!this.isGameActive || this.isPaused) return;
      
      const itemType = Math.random();
      if (itemType < 0.4) {
        this.spawnAmmo();
      } else if (itemType < 0.7) {
        this.spawnHealth();
      } else {
        this.spawnShield();
      }
    }, this.itemSpawnRate);
  }

  spawnAmmo() {
    if (this.ammoVisible) return;
    
    const pos = this.getRandomEmptyPosition();
    this.ammoPos = pos;
    this.ammoVisible = true;
    this.renderMaze();
    
    this.ammoTimeout = setTimeout(() => {
      this.hideAmmo();
    }, 5000);
  }

  hideAmmo() {
    this.ammoVisible = false;
    this.ammoPos = null;
    this.renderMaze();
  }

  spawnHealth() {
    if (this.healthVisible) return;
    
    const pos = this.getRandomEmptyPosition();
    this.healthPos = pos;
    this.healthVisible = true;
    this.renderMaze();
    
    this.healthTimeout = setTimeout(() => {
      this.hideHealth();
    }, 5000);
  }

  hideHealth() {
    this.healthVisible = false;
    this.healthPos = null;
    this.renderMaze();
  }

  spawnShield() {
    if (this.shieldVisible) return;
    
    const pos = this.getRandomEmptyPosition();
    this.shieldPos = pos;
    this.shieldVisible = true;
    this.renderMaze();
    
    this.shieldTimeout = setTimeout(() => {
      this.hideShield();
    }, 5000);
  }

  hideShield() {
    this.shieldVisible = false;
    this.shieldPos = null;
    this.renderMaze();
  }

  startSafeZoneSpawning() {
    this.safeZoneTimeout = setTimeout(() => {
      if (!this.isGameActive || this.isPaused) return;
      this.spawnSafeZone();
      this.startSafeZoneSpawning();
    }, this.safeZoneRate);
  }

  spawnSafeZone() {
    const pos = this.getRandomEmptyPosition();
    this.safeZones.push(pos);
    this.renderMaze();
    this.showEventNotification('üõ°Ô∏è –ó\'—è–≤–∏–ª–∞—Å—è –±–µ–∑–ø–µ—á–Ω–∞ –∑–æ–Ω–∞!');
    
    setTimeout(() => {
      this.safeZones = this.safeZones.filter(sz => 
        !(sz[0] === pos[0] && sz[1] === pos[1])
      );
      this.renderMaze();
      this.showEventNotification('‚ö†Ô∏è –ë–µ–∑–ø–µ—á–Ω–∞ –∑–æ–Ω–∞ –∑–Ω–∏–∫–ª–∞!');
    }, 8000);
  }

  startTimer() {
    if (this.timerInterval) clearInterval(this.timerInterval);
    this.timerInterval = setInterval(() => {
      if (!this.isPaused && this.isGameActive) {
        this.survivalTime = Math.floor((Date.now() - this.startTime) / 1000);
        const minutes = Math.floor(this.survivalTime / 60);
        const seconds = this.survivalTime % 60;
        this.timerEl.textContent = `–ß–∞—Å –≤–∏–∂–∏–≤–∞–Ω–Ω—è: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        // –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è —Ä—ñ–≤–Ω—è –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥
        const newLevel = Math.floor(this.survivalTime / 30) + 1;
        if (newLevel > this.playerLevel) {
          this.playerLevel = newLevel;
          this.updateStats();
          this.showEventNotification(`üèÜ –†—ñ–≤–µ–Ω—å ${this.playerLevel}! –ë—ñ–ª—å—à–µ –∑–æ–º–±—ñ!`);
          
          // –î–æ–¥–∞—î–º–æ –Ω–æ–≤–∏—Ö –∑–æ–º–±—ñ
          const additionalZombies = this.difficulty === 'easy' ? 1 : 
                                   this.difficulty === 'medium' ? 2 :
                                   this.difficulty === 'hard' ? 3 : 4;
          
          for (let i = 0; i < additionalZombies; i++) {
            this.spawnZombie();
          }
        }
      }
    }, 1000);
  }

  updateStats() {
    document.getElementById('healthDisplay').textContent = this.playerHealth;
    document.getElementById('shieldDisplay').textContent = this.playerShield;
    document.getElementById('ammoDisplay').textContent = this.playerAmmo;
    document.getElementById('zombieCount').textContent = this.zombies.length;
    document.getElementById('levelDisplay').textContent = this.playerLevel;
  }

  updateStatus(status) {
    const statusMap = {
      'ready': { text: '–ì–æ—Ç–æ–≤ –¥–æ –≤–∏–∂–∏–≤–∞–Ω–Ω—è', class: 'status-ready' },
      'playing': { text: '–í–∏–∂–∏–≤–∞—î...', class: 'status-playing' },
      'finished': { text: '–ó–∞–≥–∏–Ω—É–≤!', class: 'status-finished' }
    };

    const statusInfo = statusMap[status];
    if (statusInfo) {
      this.playerStatusEl.textContent = statusInfo.text;
      this.playerStatusEl.className = `player-status ${statusInfo.class}`;
    }
  }

  togglePause() {
    this.isPaused = !this.isPaused;
    this.pauseBtn.textContent = this.isPaused ? '‚ñ∂Ô∏è –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏' : '‚è∏Ô∏è –ü–∞—É–∑–∞';

    if (this.isPaused) {
      this.updateStatus('ready');
    } else {
      this.updateStatus('playing');
      this.startTime += Date.now() - this.pauseTime;
    }

    if (this.isPaused) {
      this.pauseTime = Date.now();
    }
  }

  endGame(survived) {
    this.isGameActive = false;
    this.clearAllIntervals();
    
    if (survived) {
      this.winnerText.textContent = 'üèÜ –í–ò–ñ–ò–í!';
      this.winnerMessage.textContent = `–í—ñ—Ç–∞—î–º–æ! –í–∏ –≤–∏–∂–∏–ª–∏ ${Math.floor(this.survivalTime / 60)}:${(this.survivalTime % 60).toString().padStart(2, '0')} —Ö–≤–∏–ª–∏–Ω!\n–ó–Ω–∏—â–µ–Ω–æ –∑–æ–º–±—ñ: ${this.zombiesKilled}\n–î–æ—Å—è–≥–Ω—É—Ç–∏–π —Ä—ñ–≤–µ–Ω—å: ${this.playerLevel}`;
    } else {
      this.winnerText.textContent = 'üíÄ –ó–ê–ì–ò–ù–£–í!';
      this.winnerMessage.textContent = `–í–∏ –Ω–µ –≤–∏–∂–∏–ª–∏ –≤ –∑–æ–º–±—ñ-–∞–ø–æ–∫–∞–ª—ñ–ø—Å–∏—Å—ñ!\n–ß–∞—Å –≤–∏–∂–∏–≤–∞–Ω–Ω—è: ${Math.floor(this.survivalTime / 60)}:${(this.survivalTime % 60).toString().padStart(2, '0')}\n–ó–Ω–∏—â–µ–Ω–æ –∑–æ–º–±—ñ: ${this.zombiesKilled}\n–î–æ—Å—è–≥–Ω—É—Ç–∏–π —Ä—ñ–≤–µ–Ω—å: ${this.playerLevel}`;
    }
    
    this.winnerOverlay.style.display = 'flex';
    this.pauseBtn.disabled = true;
  }

  showEventNotification(message) {
    const existingNotification = document.querySelector('.event-notification');
    if (existingNotification) {
      existingNotification.remove();
    }

    const notification = document.createElement('div');
    notification.className = 'event-notification';
    notification.textContent = message;
    document.body.appendChild(notification);

    setTimeout(() => {
      if (notification.parentNode) {
        notification.style.animation = 'fadeOut 0.5s ease-out';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.remove();
          }
        }, 500);
      }
    }, 3000);
  }
}

// –ó–∞–ø—É—Å–∫ –≥—Ä–∏
window.addEventListener('DOMContentLoaded', () => {
  window.zombieGame = new ZombieApocalypseGame();
});
</script>

<nav style="margin-bottom: 18px;">
  <a href="index.html" style="color:#fff; font-weight:bold; margin-right:18px; text-decoration:none;">–ì–æ–ª–æ–≤–Ω–∞</a>
  <a href="global.html" style="color:#fff; font-weight:bold; margin-right:18px; text-decoration:none;">GLOBAL</a>
  <a href="standings.html" style="color:#fff; font-weight:bold; text-decoration:none;">–¢—É—Ä–Ω—ñ—Ä–Ω–∞ —Ç–∞–±–ª–∏—Ü—è</a>
</nav>

<div class="instructions">
  <h3>üßü‚Äç‚ôÇÔ∏è –ó–æ–º–±—ñ-–ê–ø–æ–∫–∞–ª—ñ–ø—Å–∏—Å: –õ–∞–±—ñ—Ä–∏–Ω—Ç –í–∏–∂–∏–≤–∞–Ω–Ω—è</h3>
  <p><strong>üéØ –¶—ñ–ª—å:</strong> –í–∏–∂–∏—Ç–∏ —è–∫–æ–º–æ–≥–∞ –¥–æ–≤—à–µ, –∑–±–∏—Ä–∞—é—á–∏ —Ä–µ—Å—É—Ä—Å–∏ —Ç–∞ —É–Ω–∏–∫–∞—é—á–∏ –∑–æ–º–±—ñ!</p>
  <p><strong>üéÆ –ö–µ—Ä—É–≤–∞–Ω–Ω—è:</strong> –°—Ç—Ä—ñ–ª–∫–∏ ‚Üê‚Üë‚Üì‚Üí –∞–±–æ WASD –¥–ª—è —Ä—É—Ö—É, –ü—Ä–æ–±—ñ–ª –¥–ª—è —Å—Ç—Ä—ñ–ª—å–±–∏</p>
  <p><strong>üìã –ü—Ä–∞–≤–∏–ª–∞:</strong> –ó–µ–ª–µ–Ω–∏–π –∫–≤–∞–¥—Ä–∞—Ç - —Å—Ç–∞—Ä—Ç. –ó–±–∏—Ä–∞–π—Ç–µ –ø–∞—Ç—Ä–æ–Ω–∏, –∑–¥–æ—Ä–æ–≤'—è —Ç–∞ —â–∏—Ç–∏. –ë–µ–∑–ø–µ—á–Ω—ñ –∑–æ–Ω–∏ —Ç–∏–º—á–∞—Å–æ–≤–æ –∑–∞—Ö–∏—â–∞—é—Ç—å –≤—ñ–¥ –∑–æ–º–±—ñ!</p>
  <p><strong>üèÜ –†—ñ–≤–Ω—ñ —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ:</strong> –õ–µ–≥–∫–∏–π, –°–µ—Ä–µ–¥–Ω—ñ–π, –í–∞–∂–∫–∏–π, –ö–æ—à–º–∞—Ä</p>
</div>
</body>
</html>
